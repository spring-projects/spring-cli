environment:
  properties:
    jpackageDir: out/jreleaser/assemble/spring-cli-installer/jpackage
    jlinkDir: out/jreleaser/assemble/spring-cli-standalone/jlink/

project:
  name: spring-cli
  description: Spring Cli
  longDescription: Spring Cli
  authors:
    - jvalkeal
  license: Apache-2.0
  links:
    homepage: https://github.com/spring-projects-experimental/spring-cli
  java:
    groupId: org.springframework.experimental
    version: 17
  inceptionYear: 2023

assemble:
  javaArchive:
    spring-cli:
      active: ALWAYS
      mainJar:
        path: build/libs/{{distributionName}}-{{projectVersion}}.jar
      executable:
        name: spring

  jlink:
    spring-cli-standalone:
      active: ALWAYS
      executable: spring
      jdeps:
        multiRelease: base
        ignoreMissingDeps: true
      additionalModuleNames:
        - java.desktop
        - jdk.crypto.ec
      mainJar:
        path: 'build/libs/spring-cli-{{projectVersion}}.jar'
      targetJdks:
        - path: 'build/jdks/bellsoft17Linux/jdk-17.0.9'
          platform: 'linux-x86_64'
        - path: 'build/jdks/bellsoft17Osx/jdk-17.0.9.jdk'
          platform: 'osx-x86_64'
        - path: 'build/jdks/bellsoft17OsxArm/jdk-17.0.9.jdk'
          platform: 'osx-aarch_64'
        - path: 'build/jdks/bellsoft17Windows/jdk-17.0.9'
          platform: 'windows-x86_64'

  jpackage:
    spring-cli-installer:
      active: ALWAYS
      exported: true
      jlink: spring-cli-standalone
      applicationPackage:
        appName: spring
        appVersion: '{{projectVersionNumber}}'
        vendor: Spring

      mainJar:
        path: 'build/libs/{{distributionName}}-{{projectVersion}}.jar'
      java:
        mainClass: org.springframework.boot.loader.JarLauncher
      linux:
        types: [deb,rpm]
        maintainer: jreleaser@kordamp.org
      windows:
        types: [msi]
        console: true
        dirChooser: true

platform:
  replacements:
    aarch_64: aarch64

release:
  github:
    releaseName: '{{projectVersion}}'
    changelog:
      enabled: false

distributions:
  spring-cli:
    type: SINGLE_JAR
    artifacts:
      - path: build/libs/{{distributionName}}-{{projectVersion}}.jar
  spring-cli-standalone:
    brew:
      active: ALWAYS
      formulaName: spring-cli
      multiPlatform: true
      templateDirectory: src/jreleaser/templates/jlink/brew
      tap:
        name: homebrew-spring-cli
    artifacts:
      - path: '{{jlinkDir}}/org.springframework.experimental.spring-cli-{{projectVersion}}-linux-x86_64.zip'
        transform: '{{distributionName}}/{{distributionName}}-{{projectVersion}}-linux.x86_64.zip'
        platform: 'linux-x86_64'
      - path: '{{jlinkDir}}/org.springframework.experimental.spring-cli-{{projectVersion}}-osx-x86_64.zip'
        transform: '{{distributionName}}/{{distributionName}}-{{projectVersion}}-osx.x86_64.zip'
        platform: 'osx-x86_64'
      - path: '{{jlinkDir}}/org.springframework.experimental.spring-cli-{{projectVersion}}-osx-aarch64.zip'
        transform: '{{distributionName}}/{{distributionName}}-{{projectVersion}}-osx.aarch64.zip'
        platform: 'osx-aarch_64'
      - path: '{{jlinkDir}}/org.springframework.experimental.spring-cli-{{projectVersion}}-windows-x86_64.zip'
        transform: '{{distributionName}}/{{distributionName}}-{{projectVersion}}-windows.x86_64.zip'
        platform: 'windows-x86_64'
  spring-cli-installer:
    type: NATIVE_PACKAGE
    artifacts:
      - path: '{{jpackageDir}}/spring_{{projectVersionNumber}}-1_amd64.deb'
        transform: '{{distributionName}}/{{distributionName}}_{{projectVersion}}-1_amd64.deb'
        platform: 'linux-x86_64'
      - path: '{{jpackageDir}}/spring-{{projectVersionNumber}}-1.x86_64.rpm'
        transform: '{{distributionName}}/{{distributionName}}-{{projectVersion}}-1.x86_64.rpm'
        platform: 'linux-x86_64'
      - path: '{{jpackageDir}}/spring-{{projectVersionNumber}}.msi'
        transform: '{{distributionName}}/{{distributionName}}-{{projectVersion}}-windows-x86_64.msi'
        platform: 'windows-x86_64'
